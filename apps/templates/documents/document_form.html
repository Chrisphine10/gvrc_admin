{% extends 'layouts/base.html' %}
{% load static %}

{% block title %} {{ action }} Document {% endblock title %}

{% block content %}
  <div class="container-fluid py-4">
    
    <!-- Header with breadcrumb navigation -->
    <div class="row">
      <div class="col-12">
        <nav aria-label="breadcrumb" class="mb-3">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{% url 'facilities:facility_list' %}">Facilities</a></li>
            <li class="breadcrumb-item"><a href="{% url 'documents:document_list' %}">Documents</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ action }} Document</li>
          </ol>
        </nav>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-end">
          <a href="{% url 'documents:document_list' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Documents
          </a>
        </div>
      </div>
    </div>
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card">
          <div class="card-header">
            <h3 class="mb-0">{{ action }} Document</h3>
          </div>
          <div class="card-body">
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              {% endfor %}
            {% endif %}

            <form method="post">
              {% csrf_token %}
              
              <!-- Basic Information -->
              <div class="row">
                <div class="col-lg-8">
                  <div class="form-group">
                    <label for="title" class="form-control-label">Document Title *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      id="title" 
                      name="title" 
                      value="{{ document.title|default:'' }}" 
                      placeholder="Enter document title"
                      required
                    >
                    <small class="form-text text-muted">
                      Provide a clear, descriptive title for the document.
                    </small>
                  </div>
                </div>
                <div class="col-lg-4">
                  <div class="form-group">
                    <label for="document_type" class="form-control-label">Document Type *</label>
                    <select class="form-control" id="document_type" name="document_type" required>
                      <option value="">Select Document Type</option>
                      {% for doc_type in document_types %}
                        <option value="{{ doc_type.id }}" {% if document.document_type.id == doc_type.id %}selected{% endif %}>
                          {{ doc_type.type_name }}
                        </option>
                      {% endfor %}
                    </select>
                    <small class="form-text text-muted">
                      Choose the appropriate category for this document.
                    </small>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="description" class="form-control-label">Description</label>
                <textarea 
                  class="form-control" 
                  id="description" 
                  name="description" 
                  rows="3" 
                  placeholder="Provide a brief description of the document content..."
                >{{ document.description|default:'' }}</textarea>
                <small class="form-text text-muted">
                  Describe what this document contains and its purpose.
                </small>
              </div>

              <!-- File Information -->
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label for="file_url" class="form-control-label">File URL</label>
                    <input 
                      type="url" 
                      class="form-control" 
                      id="file_url" 
                      name="file_url" 
                      value="{{ document.file_url|default:'' }}" 
                      placeholder="https://example.com/document.pdf"
                    >
                    <small class="form-text text-muted">
                      Optional: Provide a direct link to the document file.
                    </small>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label for="file_name" class="form-control-label">File Name</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      id="file_name" 
                      name="file_name" 
                      value="{{ document.file_name|default:'' }}" 
                      placeholder="document.pdf"
                    >
                    <small class="form-text text-muted">
                      Optional: Specify the original filename.
                    </small>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="content" class="form-control-label">Document Content</label>
                <textarea 
                  class="form-control" 
                  id="content" 
                  name="content" 
                  rows="6" 
                  placeholder="Enter the document content or text here..."
                >{{ document.content|default:'' }}</textarea>
                <small class="form-text text-muted">
                  For text-based documents, you can enter the content directly here.
                </small>
              </div>

              <!-- Media & Links -->
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label for="gbv_category" class="form-control-label">GBV Category</label>
                    <select class="form-control" id="gbv_category" name="gbv_category">
                      <option value="">Select GBV Category</option>
                      {% for category in gbv_categories %}
                        <option value="{{ category.id }}" {% if document.gbv_category.id == category.id %}selected{% endif %}>
                          {{ category.category_name }}
                        </option>
                      {% endfor %}
                    </select>
                    <small class="form-text text-muted">
                      Optional: Categorize by Gender-Based Violence type if applicable.
                    </small>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label for="image_url" class="form-control-label">Image URL</label>
                    <input 
                      type="url" 
                      class="form-control" 
                      id="image_url" 
                      name="image_url" 
                      value="{{ document.image_url|default:'' }}" 
                      placeholder="https://example.com/image.jpg"
                    >
                    <small class="form-text text-muted">
                      Optional: Provide a link to a related image or thumbnail.
                    </small>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="external_url" class="form-control-label">External URL</label>
                <input 
                  type="url" 
                  class="form-control" 
                  id="external_url" 
                  name="external_url" 
                  value="{{ document.external_url|default:'' }}" 
                  placeholder="https://example.com/external-link"
                >
                <small class="form-text text-muted">
                  Optional: Link to an external resource or related website.
                </small>
              </div>

              <!-- Settings -->
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <div class="custom-control custom-switch">
                      <input type="checkbox" class="custom-control-input" id="is_public" name="is_public"
                             {% if document.is_public %}checked{% endif %}>
                      <label class="custom-control-label" for="is_public">
                        Make this document public
                      </label>
                    </div>
                    <small class="form-text text-muted">
                      Public documents are visible to all users. Private documents are restricted.
                    </small>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label">Uploaded By</label>
                    <input type="text" class="form-control" value="{{ request.user.full_name }}" readonly>
                    <small class="form-text text-muted">
                      This document will be associated with your user account.
                    </small>
                  </div>
                </div>
              </div>

              <!-- Document Examples -->
              <div class="form-group">
                <label class="form-control-label">Document Examples</label>
                <div class="row">
                  <div class="col-md-6">
                    <div class="card bg-light">
                      <div class="card-body p-3">
                        <h6 class="card-title text-primary">Common Document Types</h6>
                        <ul class="list-unstyled mb-0">
                          <li><small>• <strong>Reports:</strong> Monthly, quarterly, annual reports</small></li>
                          <li><small>• <strong>Policies:</strong> Guidelines, procedures, standards</small></li>
                          <li><small>• <strong>Forms:</strong> Applications, surveys, checklists</small></li>
                          <li><small>• <strong>Training:</strong> Manuals, guides, presentations</small></li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card bg-light">
                      <div class="card-body p-3">
                        <h6 class="card-title text-success">Best Practices</h6>
                        <ul class="list-unstyled mb-0">
                          <li><small>• Use descriptive titles</small></li>
                          <li><small>• Provide clear descriptions</small></li>
                          <li><small>• Choose appropriate categories</small></li>
                          <li><small>• Set proper visibility levels</small></li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Next Steps -->
              <div class="form-group">
                <label class="form-control-label">Next Steps</label>
                <div class="alert alert-info">
                  <i class="fas fa-info-circle"></i>
                  <strong>After {{ action|lower }}ing this document:</strong>
                  <ol class="mb-0 mt-2">
                    <li>Review the document details and ensure accuracy</li>
                    <li>Set appropriate visibility (public/private) based on content</li>
                    <li>Consider adding relevant tags or categories</li>
                    <li>Share with appropriate team members if needed</li>
                  </ol>
                </div>
              </div>

              <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-save"></i> {{ action }} Document
                </button>
                <a href="{% url 'documents:document_list' %}" class="btn btn-secondary btn-lg ml-2">
                  <i class="fas fa-times"></i> Cancel
                </a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block javascripts %}
  <script>
    $(document).ready(function() {
      // Form validation
      $('form').on('submit', function(e) {
        const title = $('#title').val().trim();
        const documentType = $('#document_type').val();
        
        if (!title) {
          e.preventDefault();
          alert('Document title is required.');
          $('#title').focus();
          return false;
        }
        
        if (!documentType) {
          e.preventDefault();
          alert('Document type is required.');
          $('#document_type').focus();
          return false;
        }
        
        if (title.length < 3) {
          e.preventDefault();
          alert('Document title must be at least 3 characters long.');
          $('#title').focus();
          return false;
        }
      });
      
      // Auto-hide alerts after 5 seconds
      setTimeout(function() {
        $('.alert').fadeOut('slow');
      }, 5000);
    });
  </script>
{% endblock javascripts %}
