{% extends 'layouts/base.html' %}

{% block title %}Add Service & Program - GVRC Admin{% endblock %}

{% block content %}
<div class="header bg-success pb-6">
  <div class="container-fluid">
    <div class="header-body">
      <div class="row align-items-center py-4">
        <div class="col-lg-6 col-7">
          <h6 class="h2 text-white d-inline-block mb-0">Add Service & Program</h6>
          <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
            <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
              <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i></a></li>
              <li class="breadcrumb-item"><a href="/services/">Services & Programs</a></li>
              <li class="breadcrumb-item active" aria-current="page">Add Service</li>
            </ol>
          </nav>
        </div>
        <div class="col-lg-6 col-5 text-right">
          <a href="/services/" class="btn btn-sm btn-neutral">
            <i class="fas fa-list"></i> View All
          </a>
          <a href="/admin/facilities/facility_services/" class="btn btn-sm btn-neutral">
            <i class="fas fa-cog"></i> Admin Panel
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Page content -->
<div class="container-fluid mt--6">
  <div class="row">
    <div class="col">
      <div class="card">
        <!-- Card header -->
        <div class="card-header border-0">
          <div class="row align-items-center">
            <div class="col">
              <h3 class="mb-0">Add New Service & Program</h3>
              <p class="text-sm text-muted mb-0">
                Fill in the details below to register a new service or program
              </p>
            </div>
          </div>
        </div>

        <!-- Toast Notifications -->
        {% if toast_type and toast_message %}
        <div class="card-header border-0 bg-light">
          <div class="alert alert-{{ toast_type }} alert-dismissible fade show" role="alert">
            <span class="alert-icon"><i class="fas fa-{% if toast_type == 'success' %}check-circle{% else %}exclamation-triangle{% endif %}"></i></span>
            <span class="alert-text">{{ toast_message }}</span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        </div>
        {% endif %}

        <!-- Form -->
        <div class="card-body">
          <form method="post">
            {% csrf_token %}
            
            <!-- Service Information -->
            <h6 class="heading-small text-muted mb-4">Service Information</h6>
            <div class="pl-lg-4">
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="service_name">Service Name *</label>
                    <input type="text" id="service_name" name="service_name" class="form-control {% if errors %}is-invalid{% endif %}" 
                           placeholder="Enter service name" 
                           value="{{ form_data.service_name|default:'' }}" required>
                    {% if errors %}
                    <div class="invalid-feedback">
                      {% for error in errors %}
                        {% if 'name' in error or 'Service name' in error %}{{ error }}{% endif %}
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="category">Service Category *</label>
                    <select id="category" name="category" class="form-control {% if errors %}is-invalid{% endif %}" required>
                      <option value="">Select service category</option>
                      {% for value, label in service_categories %}
                      <option value="{{ value }}" {% if form_data.category == value %}selected{% endif %}>{{ label }}</option>
                      {% endfor %}
                    </select>
                    {% if errors %}
                    <div class="invalid-feedback">
                      {% for error in errors %}
                        {% if 'category' in error or 'Service category' in error %}{{ error }}{% endif %}
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="facility">Facility *</label>
                    <select id="facility" name="facility" class="form-control {% if errors %}is-invalid{% endif %}" required>
                      <option value="">Select facility</option>
                      {% for facility in facilities %}
                      <option value="{{ facility.id }}" {% if form_data.facility == facility.id|stringformat:"s" %}selected{% endif %}>
                        {{ facility.name }} - {{ facility.get_facility_type_display }}
                      </option>
                      {% endfor %}
                    </select>
                    {% if errors %}
                    <div class="invalid-feedback">
                      {% for error in errors %}
                        {% if 'facility' in error or 'Facility' in error %}{{ error }}{% endif %}
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="is_available">Service Status</label>
                    <div class="custom-control custom-switch">
                      <input type="checkbox" class="custom-control-input" id="is_available" name="is_available" 
                             {% if form_data.is_available %}checked{% endif %}>
                      <label class="custom-control-label" for="is_available">Service is available</label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <label class="form-control-label" for="description">Service Description</label>
                    <textarea rows="4" id="description" name="description" class="form-control" 
                              placeholder="Provide a detailed description of the service, including what it offers, who it serves, and any special requirements">{{ form_data.description|default:'' }}</textarea>
                  </div>
                </div>
              </div>
            </div>

            <hr class="my-4" />

            <!-- Form Actions -->
            <div class="pl-lg-4">
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-save"></i> Create Service
                    </button>
                    <a href="/services/" class="btn btn-secondary">
                      <i class="fas fa-times"></i> Cancel
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
// Auto-hide toast notifications after 5 seconds
document.addEventListener('DOMContentLoaded', function() {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(function(alert) {
        setTimeout(function() {
            if (alert.parentNode) {
                alert.parentNode.removeChild(alert);
            }
        }, 5000);
    });
});
</script>
{% endblock %}
